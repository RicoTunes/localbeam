<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalBeam</title>
    <link rel="stylesheet" href="/static/css/style.css?v=10">
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/css/poppins.css">
</head>
<body>
<div class="app-shell">

    <!-- Title Bar -->
    <div class="title-bar">
        <div class="title-bar-left">
            <div class="title-icon"><i class="fas fa-bolt"></i></div>
            <span class="title-name">LocalBeam</span>
            <span class="title-ver">v1.0</span>
        </div>
        <div class="title-bar-center">
            <span class="status-dot"></span>
            <span class="status-text">Server running on <strong id="serverUrl">{{ server_url }}</strong></span>
        </div>
        <div class="title-bar-right">
            <button class="tb-btn" onclick="copyUrl()" title="Copy URL"><i class="fas fa-copy"></i></button>
            <div class="win-controls">
                <span class="wc wc-min"></span>
                <span class="wc wc-max"></span>
                <span class="wc wc-close"></span>
            </div>
        </div>
    </div>

    <!-- Body -->
    <div class="app-body">

        <!-- Navigation Rail -->
        <nav class="nav-rail">
            <div class="rail-logo"><i class="fas fa-bolt"></i></div>
            <div class="rail-items">
                <button class="rail-item active" onclick="switchPage('dashboard',this)">
                    <i class="fas fa-home"></i><span>Home</span>
                </button>
                <button class="rail-item" onclick="switchPage('files',this)">
                    <i class="fas fa-folder-open"></i><span>Files</span>
                </button>
                <button class="rail-item" onclick="switchPage('transfer',this)">
                    <i class="fas fa-exchange-alt"></i><span>Transfer</span>
                </button>
                <button class="rail-item" onclick="switchPage('settings',this)">
                    <i class="fas fa-cog"></i><span>Settings</span>
                </button>
            </div>
            <div class="rail-footer">
                <a href="/browser" class="rail-item" title="Phone browser view">
                    <i class="fas fa-mobile-alt"></i><span>Phone</span>
                </a>
            </div>
        </nav>

        <!-- Main -->
        <main class="app-main">

            <!-- PAGE: Dashboard -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-sub">Scan the QR code with the LocalBeam app to pair instantly</p>
                    </div>
                    <button class="m3-btn" onclick="refreshFiles()"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
                <div class="dash-grid">
                    <div class="m3-card qr-card">
                        <div class="card-lbl"><i class="fas fa-qrcode"></i> Scan to Connect</div>
                        <div class="qr-wrap"><img id="qrCode" src="{{ qr_code }}" alt="QR"></div>
                        <p class="qr-hint">Point phone camera here</p>
                        <div class="qr-url-row">
                            <code id="qrUrl">{{ server_url }}</code>
                            <button class="icon-btn" onclick="copyUrl()"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <div class="m3-card stats-card">
                        <div class="card-lbl"><i class="fas fa-chart-bar"></i> Stats</div>
                        <div class="stat-grid">
                            <div class="stat-tile">
                                <span class="stat-val" id="fileCount"></span>
                                <span class="stat-lbl">Files</span>
                            </div>
                            <div class="stat-tile">
                                <span class="stat-val" id="totalSize"></span>
                                <span class="stat-lbl">Total size</span>
                            </div>
                            <div class="stat-tile">
                                <span class="stat-val" id="transferCount">0</span>
                                <span class="stat-lbl">Transfers</span>
                            </div>
                        </div>
                        <div class="info-row"><i class="fas fa-folder"></i><span id="sharedDir">Loading</span></div>
                        <div class="info-row"><i class="fas fa-server"></i><span>Flask :5001 &nbsp;|&nbsp; FastTCP :5002</span></div>
                    </div>
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-clock"></i> Recent</div>
                        <ul class="recent-list" id="recentList">
                            <li class="skel"></li><li class="skel"></li><li class="skel"></li>
                        </ul>
                    </div>
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-lightbulb"></i> How to Connect</div>
                        <ol class="how-list">
                            <li><span class="how-num">1</span>Connect phone &amp; PC to the same Wi-Fi</li>
                            <li><span class="how-num">2</span>Open LocalBeam app &rarr; tap <strong>Scan QR</strong></li>
                            <li><span class="how-num">3</span>Point camera at the QR code above — paired!</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- PAGE: Files -->
            <div class="page" id="page-files">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Files</h1>
                        <p class="page-sub">All files in your shared directory</p>
                    </div>
                    <div class="hdr-actions">
                        <button class="m3-btn secondary" onclick="uploadFile()"><i class="fas fa-upload"></i> Upload</button>
                        <button class="m3-btn" onclick="refreshFiles()"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                </div>
                <div class="m3-card files-card">
                    <div class="search-bar">
                        <i class="fas fa-search si"></i>
                        <input type="text" id="fileSearch" placeholder="Search files" oninput="filterFiles()">
                        <span id="searchCount" class="search-count"></span>
                    </div>
                    <div class="file-col-hdr">
                        <span>Name</span><span>Size</span><span>Modified</span><span>Actions</span>
                    </div>
                    <div class="file-list" id="fileList">
                        <div class="file-empty"><i class="fas fa-spinner fa-spin"></i> Loading</div>
                    </div>
                </div>
            </div>

            <!-- PAGE: Transfer -->
            <div class="page" id="page-transfer">
                <div class="page-header">
                    <h1 class="page-title">Transfer</h1>
                    <p class="page-sub">Live activity between paired devices</p>
                </div>
                <div class="transfer-grid">
                    <!-- Live feed -->
                    <div class="m3-card" style="grid-column:1/-1">
                        <div class="card-lbl" style="justify-content:space-between">
                            <span><i class="fas fa-exchange-alt"></i> Live Transfer Feed</span>
                            <span id="xferConnBadge"></span>
                        </div>
                        <div class="transfer-feed" id="transferFeed">
                            <div class="xfer-empty"><i class="fas fa-satellite-dish" style="font-size:2rem;display:block;margin-bottom:10px;color:var(--surface2)"></i>Waiting for transfers…<br><small>Download a file from the phone browser to see activity here</small></div>
                        </div>
                    </div>
                    <!-- Upload from phone -->
                    <div class="m3-card drop-zone" id="dropZone" onclick="uploadFile()" ondragover="onDragOver(event)" ondrop="onDrop(event)" ondragleave="onDragLeave(event)">
                        <i class="fas fa-cloud-upload-alt drop-icon"></i>
                        <p class="drop-title">Upload to shared folder</p>
                        <p class="drop-sub">Drop files or click to select</p>
                    </div>
                    <!-- Clipboard -->
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-clipboard"></i> Clipboard Share</div>
                        <textarea id="clipboardText" class="clip-area" placeholder="Type or paste text to share with your phone" rows="4"></textarea>
                        <button class="m3-btn" style="margin-top:12px" onclick="shareClipboard()"><i class="fas fa-share"></i> Share to Phone</button>
                    </div>
                </div>
            </div>

            <!-- PAGE: Settings -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-sub">Server configuration</p>
                </div>
                <div class="settings-grid">
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-folder"></i> Shared Directory</div>
                        <p class="setting-val" id="settingDir">Loading</p>
                        <button class="m3-btn" style="margin-top:12px" onclick="changeDirectory()"><i class="fas fa-folder-open"></i> Change Directory</button>
                    </div>
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-network-wired"></i> Network</div>
                        <div class="info-row"><i class="fas fa-globe"></i><span>IP: <strong id="settingIp"></strong></span></div>
                        <div class="info-row"><i class="fas fa-plug"></i><span>Flask port: <strong>5001</strong></span></div>
                        <div class="info-row"><i class="fas fa-bolt"></i><span>Fast TCP port: <strong>5002</strong></span></div>
                    </div>
                    <div class="m3-card">
                        <div class="card-lbl"><i class="fas fa-info-circle"></i> About</div>
                        <div class="info-row"><i class="fab fa-python"></i><span>Python + Flask server</span></div>
                        <div class="info-row"><i class="fas fa-mobile-alt"></i><span>Flutter Android client</span></div>
                        <div class="info-row"><i class="fas fa-wifi"></i><span>LAN only  no internet needed</span></div>
                        <div class="info-row"><i class="fas fa-tag"></i><span>Version 1.0</span></div>
                    </div>
                </div>
            </div>

        </main>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>
<!-- Legacy modal stubs so JS won't error -->
<div id="instructionsModal" class="modal" style="display:none"></div>
<div id="aboutModal" class="modal" style="display:none"></div>

<script src="/static/js/main.js?v=10"></script>
<script>
function switchPage(id, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.rail-item').forEach(r => r.classList.remove('active'));
    document.getElementById('page-' + id).classList.add('active');
    el.classList.add('active');
}
function onDragOver(e) { e.preventDefault(); document.getElementById('dropZone').classList.add('drag-over'); }
function onDragLeave(e) { document.getElementById('dropZone').classList.remove('drag-over'); }
function onDrop(e) {
    e.preventDefault();
    document.getElementById('dropZone').classList.remove('drag-over');
    handleFileUpload({ target: { files: e.dataTransfer.files } });
}
</script>
</body>
</html>
